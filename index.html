<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ±Ÿè¥¿çœå¤©æ°”é¢„æŠ¥</title>
    <link rel="stylesheet" href="static/styles.css">
  </head>
  <body>
    <header class="page-header">
      <h1 class="page-title">ğŸŒ¤ï¸ æ±Ÿè¥¿çœå¤©æ°”é¢„æŠ¥</h1>
      <p class="page-subtitle">å®æ—¶å¤©æ°” Â· æœªæ¥ 5 æ—¥é¢„æŠ¥ Â· è¦†ç›–å…¨çœå¸‚å¿</p>
    </header>
    <main class="page-main">
      <section class="controls glass">
        <div class="controls__inner">
          <input
            id="city-search"
            class="city-search"
            type="text"
            placeholder="ğŸ” è¾“å…¥åŸå¸‚æˆ–å¿åŒºåç§°å¿«é€ŸæŸ¥æ‰¾..."
            aria-label="è¾“å…¥åŸå¸‚æˆ–å¿åŒºé€ŸæŸ¥"
            autocomplete="off"
          >
          <div class="control-row">
            <select id="city-select" aria-label="é€‰æ‹©æ±Ÿè¥¿çœåŸå¸‚æˆ–å¿åŒº">
              <!-- Options will be populated by JavaScript -->
            </select>
            <button id="refresh-btn" type="button">ğŸ”„ åˆ·æ–°å¤©æ°”</button>
          </div>
        </div>
      </section>

      <section id="weather-display" class="weather-display glass" style="display: none;">
        <div class="weather-hero">
          <div class="weather-hero__location">
            <h2 id="location-name">--</h2>
          </div>
          <div class="weather-hero__current">
            <div class="current-temp">
              <span id="current-temperature" class="current-temp__value">--</span>
              <span class="current-temp__unit">Â°C</span>
            </div>
            <div id="current-weather" class="current-weather">--</div>
          </div>
          <div class="weather-hero__details">
            <div class="detail-item">
              <span class="detail-label">ä½“æ„Ÿæ¸©åº¦</span>
              <span id="feels-like" class="detail-value">--Â°C</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">æ¹¿åº¦</span>
              <span id="humidity" class="detail-value">--%</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">é£é€Ÿ</span>
              <span id="wind-speed" class="detail-value">-- km/h</span>
            </div>
          </div>
        </div>

        <div class="forecast">
          <h3 class="forecast__title">æœªæ¥ 5 æ—¥é¢„æŠ¥</h3>
          <div id="forecast-list" class="forecast__list">
            <!-- Forecast items will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <section id="error-display" class="error-display" style="display: none;">
        <p id="error-message"></p>
      </section>
    </main>
    <footer class="page-footer">
      <small>æ•°æ®æ¥æºï¼š<a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo å…è´¹å¤©æ°”æœåŠ¡</a></small>
    </footer>

    <script>
      // Location data
      const LOCATIONS = [
        {"id": "nanchang", "province": "æ±Ÿè¥¿çœ", "city": "å—æ˜Œå¸‚"},
        {"id": "donghu", "province": "æ±Ÿè¥¿çœ", "city": "ä¸œæ¹–åŒº"},
        {"id": "xihu", "province": "æ±Ÿè¥¿çœ", "city": "è¥¿æ¹–åŒº"},
        {"id": "qingyunpu", "province": "æ±Ÿè¥¿çœ", "city": "é’äº‘è°±åŒº"},
        {"id": "qingshanhu", "province": "æ±Ÿè¥¿çœ", "city": "é’å±±æ¹–åŒº"},
        {"id": "xinjian", "province": "æ±Ÿè¥¿çœ", "city": "æ–°å»ºåŒº"},
        {"id": "nanchang_county", "province": "æ±Ÿè¥¿çœ", "city": "å—æ˜Œå¿"},
        {"id": "anyi", "province": "æ±Ÿè¥¿çœ", "city": "å®‰ä¹‰å¿"},
        {"id": "jinxian", "province": "æ±Ÿè¥¿çœ", "city": "è¿›è´¤å¿"},
        {"id": "jiujiang", "province": "æ±Ÿè¥¿çœ", "city": "ä¹æ±Ÿå¸‚"},
        {"id": "xunyang", "province": "æ±Ÿè¥¿çœ", "city": "æµ”é˜³åŒº"},
        {"id": "lianxi", "province": "æ±Ÿè¥¿çœ", "city": "æ¿‚æºªåŒº"},
        {"id": "chaisang", "province": "æ±Ÿè¥¿çœ", "city": "æŸ´æ¡‘åŒº"},
        {"id": "wuning", "province": "æ±Ÿè¥¿çœ", "city": "æ­¦å®å¿"},
        {"id": "xiushui", "province": "æ±Ÿè¥¿çœ", "city": "ä¿®æ°´å¿"},
        {"id": "yongxiu", "province": "æ±Ÿè¥¿çœ", "city": "æ°¸ä¿®å¿"},
        {"id": "dean", "province": "æ±Ÿè¥¿çœ", "city": "å¾·å®‰å¿"},
        {"id": "duchang", "province": "æ±Ÿè¥¿çœ", "city": "éƒ½æ˜Œå¿"},
        {"id": "hukou", "province": "æ±Ÿè¥¿çœ", "city": "æ¹–å£å¿"},
        {"id": "pengze", "province": "æ±Ÿè¥¿çœ", "city": "å½­æ³½å¿"},
        {"id": "ruichang", "province": "æ±Ÿè¥¿çœ", "city": "ç‘æ˜Œå¸‚"},
        {"id": "gongqingcheng", "province": "æ±Ÿè¥¿çœ", "city": "å…±é’åŸå¸‚"},
        {"id": "lushan", "province": "æ±Ÿè¥¿çœ", "city": "åºå±±å¸‚"},
        {"id": "shangrao", "province": "æ±Ÿè¥¿çœ", "city": "ä¸Šé¥¶å¸‚"},
        {"id": "xinzhou", "province": "æ±Ÿè¥¿çœ", "city": "ä¿¡å·åŒº"},
        {"id": "guangfeng", "province": "æ±Ÿè¥¿çœ", "city": "å¹¿ä¸°åŒº"},
        {"id": "guangxin", "province": "æ±Ÿè¥¿çœ", "city": "å¹¿ä¿¡åŒº"},
        {"id": "yugan", "province": "æ±Ÿè¥¿çœ", "city": "ä½™å¹²å¿"},
        {"id": "poyang", "province": "æ±Ÿè¥¿çœ", "city": "é„±é˜³å¿"},
        {"id": "wannian", "province": "æ±Ÿè¥¿çœ", "city": "ä¸‡å¹´å¿"},
        {"id": "wuyuan", "province": "æ±Ÿè¥¿çœ", "city": "å©ºæºå¿"},
        {"id": "dexing", "province": "æ±Ÿè¥¿çœ", "city": "å¾·å…´å¸‚"},
        {"id": "yiyang", "province": "æ±Ÿè¥¿çœ", "city": "å¼‹é˜³å¿"},
        {"id": "hengfeng", "province": "æ±Ÿè¥¿çœ", "city": "æ¨ªå³°å¿"},
        {"id": "qianshan", "province": "æ±Ÿè¥¿çœ", "city": "é“…å±±å¿"},
        {"id": "yushan", "province": "æ±Ÿè¥¿çœ", "city": "ç‰å±±å¿"},
        {"id": "ganzhou", "province": "æ±Ÿè¥¿çœ", "city": "èµ£å·å¸‚"},
        {"id": "zhanggong", "province": "æ±Ÿè¥¿çœ", "city": "ç« è´¡åŒº"},
        {"id": "nankang", "province": "æ±Ÿè¥¿çœ", "city": "å—åº·åŒº"},
        {"id": "ganxian", "province": "æ±Ÿè¥¿çœ", "city": "èµ£å¿åŒº"},
        {"id": "xinfeng", "province": "æ±Ÿè¥¿çœ", "city": "ä¿¡ä¸°å¿"},
        {"id": "dayu", "province": "æ±Ÿè¥¿çœ", "city": "å¤§ä½™å¿"},
        {"id": "shangyou", "province": "æ±Ÿè¥¿çœ", "city": "ä¸ŠçŠ¹å¿"},
        {"id": "chongyi", "province": "æ±Ÿè¥¿çœ", "city": "å´‡ä¹‰å¿"},
        {"id": "anyuan", "province": "æ±Ÿè¥¿çœ", "city": "å®‰è¿œå¿"},
        {"id": "longnan", "province": "æ±Ÿè¥¿çœ", "city": "é¾™å—å¿"},
        {"id": "dingnan", "province": "æ±Ÿè¥¿çœ", "city": "å®šå—å¿"},
        {"id": "quannan", "province": "æ±Ÿè¥¿çœ", "city": "å…¨å—å¿"},
        {"id": "ningdu", "province": "æ±Ÿè¥¿çœ", "city": "å®éƒ½å¿"},
        {"id": "yudu", "province": "æ±Ÿè¥¿çœ", "city": "äºéƒ½å¿"},
        {"id": "xingguo", "province": "æ±Ÿè¥¿çœ", "city": "å…´å›½å¿"},
        {"id": "huichang", "province": "æ±Ÿè¥¿çœ", "city": "ä¼šæ˜Œå¿"},
        {"id": "xunwu", "province": "æ±Ÿè¥¿çœ", "city": "å¯»ä¹Œå¿"},
        {"id": "shicheng", "province": "æ±Ÿè¥¿çœ", "city": "çŸ³åŸå¿"},
        {"id": "ruijin", "province": "æ±Ÿè¥¿çœ", "city": "ç‘é‡‘å¸‚"},
        {"id": "jian", "province": "æ±Ÿè¥¿çœ", "city": "å‰å®‰å¸‚"},
        {"id": "jizhou", "province": "æ±Ÿè¥¿çœ", "city": "å‰å·åŒº"},
        {"id": "qingyuan", "province": "æ±Ÿè¥¿çœ", "city": "é’åŸåŒº"},
        {"id": "jishui", "province": "æ±Ÿè¥¿çœ", "city": "å‰æ°´å¿"},
        {"id": "jian_county", "province": "æ±Ÿè¥¿çœ", "city": "å‰å®‰å¿"},
        {"id": "xingan", "province": "æ±Ÿè¥¿çœ", "city": "æ–°å¹²å¿"},
        {"id": "yongfeng", "province": "æ±Ÿè¥¿çœ", "city": "æ°¸ä¸°å¿"},
        {"id": "taihe", "province": "æ±Ÿè¥¿çœ", "city": "æ³°å’Œå¿"},
        {"id": "suichuan", "province": "æ±Ÿè¥¿çœ", "city": "é‚å·å¿"},
        {"id": "wanan", "province": "æ±Ÿè¥¿çœ", "city": "ä¸‡å®‰å¿"},
        {"id": "anfu", "province": "æ±Ÿè¥¿çœ", "city": "å®‰ç¦å¿"},
        {"id": "yongxin", "province": "æ±Ÿè¥¿çœ", "city": "æ°¸æ–°å¿"},
        {"id": "jinggangshan", "province": "æ±Ÿè¥¿çœ", "city": "äº•å†ˆå±±å¸‚"},
        {"id": "yichun", "province": "æ±Ÿè¥¿çœ", "city": "å®œæ˜¥å¸‚"},
        {"id": "yuanzhou", "province": "æ±Ÿè¥¿çœ", "city": "è¢å·åŒº"},
        {"id": "fengxin", "province": "æ±Ÿè¥¿çœ", "city": "å¥‰æ–°å¿"},
        {"id": "wanzai", "province": "æ±Ÿè¥¿çœ", "city": "ä¸‡è½½å¿"},
        {"id": "shanggao", "province": "æ±Ÿè¥¿çœ", "city": "ä¸Šé«˜å¿"},
        {"id": "yifeng", "province": "æ±Ÿè¥¿çœ", "city": "å®œä¸°å¿"},
        {"id": "jing_an", "province": "æ±Ÿè¥¿çœ", "city": "é–å®‰å¿"},
        {"id": "tonggu", "province": "æ±Ÿè¥¿çœ", "city": "é“œé¼“å¿"},
        {"id": "fengcheng", "province": "æ±Ÿè¥¿çœ", "city": "ä¸°åŸå¸‚"},
        {"id": "zhangshu", "province": "æ±Ÿè¥¿çœ", "city": "æ¨Ÿæ ‘å¸‚"},
        {"id": "gaoan", "province": "æ±Ÿè¥¿çœ", "city": "é«˜å®‰å¸‚"},
        {"id": "fuzhou", "province": "æ±Ÿè¥¿çœ", "city": "æŠšå·å¸‚"},
        {"id": "linchuan", "province": "æ±Ÿè¥¿çœ", "city": "ä¸´å·åŒº"},
        {"id": "dongxiang", "province": "æ±Ÿè¥¿çœ", "city": "ä¸œä¹¡åŒº"},
        {"id": "nancheng", "province": "æ±Ÿè¥¿çœ", "city": "å—åŸå¿"},
        {"id": "lichuan", "province": "æ±Ÿè¥¿çœ", "city": "é»å·å¿"},
        {"id": "nanfeng", "province": "æ±Ÿè¥¿çœ", "city": "å—ä¸°å¿"},
        {"id": "chongren", "province": "æ±Ÿè¥¿çœ", "city": "å´‡ä»å¿"},
        {"id": "lean", "province": "æ±Ÿè¥¿çœ", "city": "ä¹å®‰å¿"},
        {"id": "yihuang", "province": "æ±Ÿè¥¿çœ", "city": "å®œé»„å¿"},
        {"id": "jinxi", "province": "æ±Ÿè¥¿çœ", "city": "é‡‘æºªå¿"},
        {"id": "zixi", "province": "æ±Ÿè¥¿çœ", "city": "èµ„æºªå¿"},
        {"id": "guangchang", "province": "æ±Ÿè¥¿çœ", "city": "å¹¿æ˜Œå¿"},
        {"id": "pingxiang", "province": "æ±Ÿè¥¿çœ", "city": "èä¹¡å¸‚"},
        {"id": "anyuan_px", "province": "æ±Ÿè¥¿çœ", "city": "å®‰æºåŒº"},
        {"id": "xiangdong", "province": "æ±Ÿè¥¿çœ", "city": "æ¹˜ä¸œåŒº"},
        {"id": "lianhua", "province": "æ±Ÿè¥¿çœ", "city": "è²èŠ±å¿"},
        {"id": "shangli", "province": "æ±Ÿè¥¿çœ", "city": "ä¸Šæ —å¿"},
        {"id": "luxi", "province": "æ±Ÿè¥¿çœ", "city": "èŠ¦æºªå¿"},
        {"id": "xinyu", "province": "æ±Ÿè¥¿çœ", "city": "æ–°ä½™å¸‚"},
        {"id": "yushui", "province": "æ±Ÿè¥¿çœ", "city": "æ¸æ°´åŒº"},
        {"id": "fenyi", "province": "æ±Ÿè¥¿çœ", "city": "åˆ†å®œå¿"},
        {"id": "yingtan", "province": "æ±Ÿè¥¿çœ", "city": "é¹°æ½­å¸‚"},
        {"id": "yujiang", "province": "æ±Ÿè¥¿çœ", "city": "ä½™æ±ŸåŒº"},
        {"id": "guixi", "province": "æ±Ÿè¥¿çœ", "city": "è´µæºªå¸‚"},
        {"id": "jingdezhen", "province": "æ±Ÿè¥¿çœ", "city": "æ™¯å¾·é•‡å¸‚"},
        {"id": "changjiang", "province": "æ±Ÿè¥¿çœ", "city": "æ˜Œæ±ŸåŒº"},
        {"id": "zhushan", "province": "æ±Ÿè¥¿çœ", "city": "ç å±±åŒº"},
        {"id": "fuliang", "province": "æ±Ÿè¥¿çœ", "city": "æµ®æ¢å¿"},
        {"id": "leping", "province": "æ±Ÿè¥¿çœ", "city": "ä¹å¹³å¸‚"}
      ];

      const DOT = 'Â·';
      let allLocations = LOCATIONS;
      let filteredLocations = LOCATIONS;

      const citySelect = document.getElementById('city-select');
      const citySearch = document.getElementById('city-search');
      const refreshBtn = document.getElementById('refresh-btn');
      const weatherDisplay = document.getElementById('weather-display');
      const errorDisplay = document.getElementById('error-display');

      function createOptionLabel(location) {
        return location.city;
      }

      function populateSelect(locations) {
        citySelect.innerHTML = '';
        locations.forEach(loc => {
          const option = document.createElement('option');
          option.value = loc.id;
          option.textContent = createOptionLabel(loc);
          citySelect.appendChild(option);
        });
      }

      function filterLocations(query) {
        if (!query.trim()) {
          filteredLocations = allLocations;
        } else {
          const lowerQuery = query.toLowerCase();
          filteredLocations = allLocations.filter(loc =>
            loc.city.toLowerCase().includes(lowerQuery) ||
            loc.id.toLowerCase().includes(lowerQuery)
          );
        }
        populateSelect(filteredLocations);
      }

      // Coordinates for major cities in Jiangxi
      const COORDINATES = {
        'nanchang': { lat: 28.6829, lon: 115.8579 },
        'donghu': { lat: 28.6850, lon: 115.8990 },
        'xihu': { lat: 28.6570, lon: 115.8770 },
        'qingyunpu': { lat: 28.6210, lon: 115.9250 },
        'qingshanhu': { lat: 28.6820, lon: 115.9620 },
        'xinjian': { lat: 28.6920, lon: 115.8150 },
        'nanchang_county': { lat: 28.5450, lon: 115.9430 },
        'anyi': { lat: 28.8450, lon: 115.5480 },
        'jinxian': { lat: 28.3760, lon: 116.2420 },
        'jiujiang': { lat: 29.7050, lon: 116.0010 },
        'xunyang': { lat: 29.7270, lon: 115.9900 },
        'lianxi': { lat: 29.6700, lon: 115.9850 },
        'chaisang': { lat: 29.6000, lon: 115.9110 },
        'wuning': { lat: 29.2560, lon: 115.1010 },
        'xiushui': { lat: 29.0250, lon: 114.5470 },
        'yongxiu': { lat: 29.0220, lon: 115.8090 },
        'dean': { lat: 29.3130, lon: 115.7560 },
        'duchang': { lat: 29.2730, lon: 116.2040 },
        'hukou': { lat: 29.7410, lon: 116.2520 },
        'pengze': { lat: 29.8960, lon: 116.5490 },
        'ruichang': { lat: 29.6740, lon: 115.6810 },
        'gongqingcheng': { lat: 29.2480, lon: 115.8040 },
        'lushan': { lat: 29.4480, lon: 115.9820 },
        'shangrao': { lat: 28.4540, lon: 117.9430 },
        'xinzhou': { lat: 28.4310, lon: 117.9660 },
        'guangfeng': { lat: 28.4360, lon: 118.1910 },
        'guangxin': { lat: 28.4500, lon: 117.9700 },
        'yugan': { lat: 28.6950, lon: 116.6960 },
        'poyang': { lat: 29.0110, lon: 116.6730 },
        'wannian': { lat: 28.6950, lon: 117.0690 },
        'wuyuan': { lat: 29.2450, lon: 117.8610 },
        'dexing': { lat: 28.9470, lon: 117.5790 },
        'yiyang': { lat: 28.3740, lon: 117.4590 },
        'hengfeng': { lat: 28.4070, lon: 117.5960 },
        'qianshan': { lat: 28.3150, lon: 117.7090 },
        'yushan': { lat: 28.6820, lon: 118.2450 },
        'ganzhou': { lat: 25.8310, lon: 114.9350 },
        'zhanggong': { lat: 25.8170, lon: 114.9350 },
        'nankang': { lat: 25.6630, lon: 114.7650 },
        'ganxian': { lat: 25.8600, lon: 115.0120 },
        'xinfeng': { lat: 25.3690, lon: 114.9090 },
        'dayu': { lat: 25.2940, lon: 114.3620 },
        'shangyou': { lat: 25.7880, lon: 114.5500 },
        'chongyi': { lat: 25.6810, lon: 114.3080 },
        'anyuan': { lat: 25.1370, lon: 115.3930 },
        'longnan': { lat: 24.9110, lon: 114.7890 },
        'dingnan': { lat: 24.7840, lon: 115.0280 },
        'quannan': { lat: 24.7420, lon: 114.5300 },
        'ningdu': { lat: 26.4700, lon: 116.0090 },
        'yudu': { lat: 25.9520, lon: 115.4150 },
        'xingguo': { lat: 26.3380, lon: 115.3630 },
        'huichang': { lat: 25.5990, lon: 115.7860 },
        'xunwu': { lat: 24.9540, lon: 115.6490 },
        'shicheng': { lat: 26.3150, lon: 116.3440 },
        'ruijin': { lat: 25.8850, lon: 116.0270 },
        'jian': { lat: 27.1110, lon: 114.9860 },
        'jizhou': { lat: 27.1440, lon: 115.0000 },
        'qingyuan': { lat: 27.0820, lon: 115.0140 },
        'jishui': { lat: 27.2290, lon: 115.1350 },
        'jian_county': { lat: 27.0400, lon: 114.9080 },
        'xingan': { lat: 27.7380, lon: 115.3950 },
        'yongfeng': { lat: 27.3180, lon: 115.4420 },
        'taihe': { lat: 26.7910, lon: 114.9080 },
        'suichuan': { lat: 26.3130, lon: 114.5200 },
        'wanan': { lat: 26.4580, lon: 114.7870 },
        'anfu': { lat: 27.3930, lon: 114.6200 },
        'yongxin': { lat: 26.9450, lon: 114.2430 },
        'jinggangshan': { lat: 26.7480, lon: 114.1890 },
        'yichun': { lat: 27.8150, lon: 114.4170 },
        'yuanzhou': { lat: 27.7970, lon: 114.4230 },
        'fengxin': { lat: 28.6920, lon: 115.4000 },
        'wanzai': { lat: 28.1060, lon: 114.4450 },
        'shanggao': { lat: 28.2340, lon: 114.9250 },
        'yifeng': { lat: 28.3940, lon: 114.7800 },
        'jing_an': { lat: 28.8610, lon: 115.3620 },
        'tonggu': { lat: 28.5230, lon: 114.3710 },
        'fengcheng': { lat: 28.1590, lon: 115.7710 },
        'zhangshu': { lat: 28.0530, lon: 115.5460 },
        'gaoan': { lat: 28.4170, lon: 115.3750 },
        'fuzhou': { lat: 27.9490, lon: 116.3580 },
        'linchuan': { lat: 27.9770, lon: 116.3130 },
        'dongxiang': { lat: 28.2360, lon: 116.5900 },
        'nancheng': { lat: 27.5540, lon: 116.6270 },
        'lichuan': { lat: 27.2790, lon: 116.9070 },
        'nanfeng': { lat: 27.2180, lon: 116.5260 },
        'chongren': { lat: 27.7540, lon: 116.0750 },
        'lean': { lat: 27.4290, lon: 115.8300 },
        'yihuang': { lat: 27.5540, lon: 116.2360 },
        'jinxi': { lat: 27.9190, lon: 116.7550 },
        'zixi': { lat: 27.7060, lon: 117.0690 },
        'guangchang': { lat: 26.8440, lon: 116.3370 },
        'pingxiang': { lat: 27.6230, lon: 113.8520 },
        'anyuan_px': { lat: 27.6150, lon: 113.8700 },
        'xiangdong': { lat: 27.6390, lon: 113.7330 },
        'lianhua': { lat: 27.1270, lon: 113.9620 },
        'shangli': { lat: 27.8800, lon: 113.7950 },
        'luxi': { lat: 27.6300, lon: 114.0290 },
        'xinyu': { lat: 27.8180, lon: 114.9170 },
        'yushui': { lat: 27.8000, lon: 114.9440 },
        'fenyi': { lat: 27.8150, lon: 114.6750 },
        'yingtan': { lat: 28.2380, lon: 117.0690 },
        'yujiang': { lat: 28.2040, lon: 116.8190 },
        'guixi': { lat: 28.2920, lon: 117.2450 },
        'jingdezhen': { lat: 29.2686, lon: 117.1786 },
        'changjiang': { lat: 29.2730, lon: 117.1750 },
        'zhushan': { lat: 29.3010, lon: 117.2140 },
        'fuliang': { lat: 29.3380, lon: 117.2150 },
        'leping': { lat: 28.9620, lon: 117.1300 }
      };

      function getWeatherDescription(code) {
        const weatherCodes = {
          0: 'æ™´å¤©',
          1: 'æ™´æœ—', 2: 'å°‘äº‘', 3: 'å¤šäº‘',
          45: 'æœ‰é›¾', 48: 'é›¾å‡‡',
          51: 'å°é›¨', 53: 'ä¸­é›¨', 55: 'å¤§é›¨',
          61: 'å°é›¨', 63: 'ä¸­é›¨', 65: 'å¤§é›¨',
          71: 'å°é›ª', 73: 'ä¸­é›ª', 75: 'å¤§é›ª',
          77: 'ç±³é›ª',
          80: 'é˜µé›¨', 81: 'é˜µé›¨', 82: 'æš´é›¨',
          85: 'é˜µé›ª', 86: 'æš´é›ª',
          95: 'é›·æš´', 96: 'é›·æš´ä¼´å†°é›¹', 99: 'é›·æš´ä¼´å†°é›¹'
        };
        return weatherCodes[code] || 'æœªçŸ¥';
      }

      async function fetchWeather(locationId) {
        try {
          const location = LOCATIONS.find(loc => loc.id === locationId);
          if (!location) {
            throw new Error('æœªæ‰¾åˆ°è¯¥åŸå¸‚');
          }

          const coords = COORDINATES[locationId];
          if (!coords) {
            throw new Error('è¯¥åŸå¸‚æš‚æ— å¤©æ°”æ•°æ®');
          }

          const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia/Shanghai&forecast_days=6`;

          const response = await fetch(url);
          if (!response.ok) {
            throw new Error('å¤©æ°”æœåŠ¡æš‚æ—¶ä¸å¯ç”¨');
          }

          const apiData = await response.json();

          const data = {
            location: {
              province: location.province,
              city: location.city
            },
            current: {
              temperature: Math.round(apiData.current.temperature_2m),
              weather: getWeatherDescription(apiData.current.weather_code),
              feels_like: Math.round(apiData.current.apparent_temperature),
              humidity: apiData.current.relative_humidity_2m,
              wind_speed: Math.round(apiData.current.wind_speed_10m)
            },
            forecast: []
          };

          for (let i = 1; i < 6; i++) {
            const date = new Date(apiData.daily.time[i]);
            const dateStr = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            data.forecast.push({
              date: dateStr,
              weather: getWeatherDescription(apiData.daily.weather_code[i]),
              max_temp: Math.round(apiData.daily.temperature_2m_max[i]),
              min_temp: Math.round(apiData.daily.temperature_2m_min[i])
            });
          }

          displayWeather(data);
        } catch (error) {
          console.error('Fetch error:', error);
          displayError('æ— æ³•è·å–å¤©æ°”æ•°æ®ï¼Œè¯·ç¨åé‡è¯•: ' + error.message);
        }
      }

      function displayWeather(data) {
        weatherDisplay.style.display = 'block';
        errorDisplay.style.display = 'none';

        document.getElementById('location-name').textContent = data.location.city;
        document.getElementById('current-temperature').textContent = data.current.temperature;
        document.getElementById('current-weather').textContent = data.current.weather;
        document.getElementById('feels-like').textContent = `${data.current.feels_like}Â°C`;
        document.getElementById('humidity').textContent = `${data.current.humidity}%`;
        document.getElementById('wind-speed').textContent = `${data.current.wind_speed} km/h`;

        const forecastList = document.getElementById('forecast-list');
        forecastList.innerHTML = '';
        data.forecast.forEach(day => {
          const item = document.createElement('div');
          item.className = 'forecast-item';
          item.innerHTML = `
            <div class="forecast-item__date">${day.date}</div>
            <div class="forecast-item__weather">${day.weather}</div>
            <div class="forecast-item__temp">
              <span class="temp-max">${day.max_temp}Â°</span>
              <span class="temp-sep">/</span>
              <span class="temp-min">${day.min_temp}Â°</span>
            </div>
          `;
          forecastList.appendChild(item);
        });
      }

      function displayError(message) {
        weatherDisplay.style.display = 'none';
        errorDisplay.style.display = 'block';
        document.getElementById('error-message').textContent = message;
      }

      // Event listeners
      citySearch.addEventListener('input', (e) => {
        filterLocations(e.target.value);
      });

      citySelect.addEventListener('change', () => {
        fetchWeather(citySelect.value);
      });

      refreshBtn.addEventListener('click', () => {
        fetchWeather(citySelect.value);
      });

      // Initialize
      populateSelect(allLocations);
      fetchWeather('nanchang');
    </script>
  </body>
</html>

