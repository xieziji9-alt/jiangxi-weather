<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ±Ÿè¥¿çœå¤©æ°”é¢„æŠ¥</title>
    <link rel="stylesheet" href="static/styles.css">
  </head>
  <body>
    <header class="page-header">
      <h1 class="page-title">ğŸŒ¤ï¸ æ±Ÿè¥¿çœå¤©æ°”é¢„æŠ¥</h1>
      <p class="page-subtitle">å®æ—¶å¤©æ°” Â· æœªæ¥ 5 æ—¥é¢„æŠ¥ Â· è¦†ç›–å…¨çœå¸‚å¿</p>
    </header>
    <main class="page-main">
      <section class="controls glass">
        <div class="controls__inner">
          <input
            id="city-search"
            class="city-search"
            type="text"
            placeholder="ğŸ” è¾“å…¥åŸå¸‚æˆ–å¿åŒºåç§°å¿«é€ŸæŸ¥æ‰¾..."
            aria-label="è¾“å…¥åŸå¸‚æˆ–å¿åŒºé€ŸæŸ¥"
            autocomplete="off"
          >
          <div class="control-row">
            <select id="city-select" aria-label="é€‰æ‹©æ±Ÿè¥¿çœåŸå¸‚æˆ–å¿åŒº">
              <!-- Options will be populated by JavaScript -->
            </select>
            <button id="refresh-btn" type="button">ğŸ”„ åˆ·æ–°å¤©æ°”</button>
          </div>
        </div>
      </section>

      <section id="weather-display" class="weather-display glass" style="display: none;">
        <div class="weather-hero">
          <div class="weather-hero__location">
            <h2 id="location-name">--</h2>
          </div>
          <div class="weather-hero__current">
            <div class="current-temp">
              <span id="current-temperature" class="current-temp__value">--</span>
              <span class="current-temp__unit">Â°C</span>
            </div>
            <div id="current-weather" class="current-weather">--</div>
          </div>
          <div class="weather-hero__details">
            <div class="detail-item">
              <span class="detail-label">ä½“æ„Ÿæ¸©åº¦</span>
              <span id="feels-like" class="detail-value">--Â°C</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">æ¹¿åº¦</span>
              <span id="humidity" class="detail-value">--%</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">é£é€Ÿ</span>
              <span id="wind-speed" class="detail-value">-- km/h</span>
            </div>
          </div>
        </div>

        <div class="forecast">
          <h3 class="forecast__title">æœªæ¥ 5 æ—¥é¢„æŠ¥</h3>
          <div id="forecast-list" class="forecast__list">
            <!-- Forecast items will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <section id="error-display" class="error-display" style="display: none;">
        <p id="error-message"></p>
      </section>
    </main>
    <footer class="page-footer">
      <small>æ•°æ®æ¥æºï¼š<a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo å…è´¹å¤©æ°”æœåŠ¡</a></small>
    </footer>

    <script>
      // Location data
      const LOCATIONS = [
        {"id": "nanchang", "province": "æ±Ÿè¥¿çœ", "city": "å—æ˜Œå¸‚"},
        {"id": "donghu", "province": "æ±Ÿè¥¿çœ", "city": "ä¸œæ¹–åŒº"},
        {"id": "xihu", "province": "æ±Ÿè¥¿çœ", "city": "è¥¿æ¹–åŒº"},
        {"id": "qingyunpu", "province": "æ±Ÿè¥¿çœ", "city": "é’äº‘è°±åŒº"},
        {"id": "qingshanhu", "province": "æ±Ÿè¥¿çœ", "city": "é’å±±æ¹–åŒº"},
        {"id": "xinjian", "province": "æ±Ÿè¥¿çœ", "city": "æ–°å»ºåŒº"},
        {"id": "nanchang_county", "province": "æ±Ÿè¥¿çœ", "city": "å—æ˜Œå¿"},
        {"id": "anyi", "province": "æ±Ÿè¥¿çœ", "city": "å®‰ä¹‰å¿"},
        {"id": "jinxian", "province": "æ±Ÿè¥¿çœ", "city": "è¿›è´¤å¿"},
        {"id": "jiujiang", "province": "æ±Ÿè¥¿çœ", "city": "ä¹æ±Ÿå¸‚"},
        {"id": "xunyang", "province": "æ±Ÿè¥¿çœ", "city": "æµ”é˜³åŒº"},
        {"id": "lianxi", "province": "æ±Ÿè¥¿çœ", "city": "æ¿‚æºªåŒº"},
        {"id": "chaisang", "province": "æ±Ÿè¥¿çœ", "city": "æŸ´æ¡‘åŒº"},
        {"id": "wuning", "province": "æ±Ÿè¥¿çœ", "city": "æ­¦å®å¿"},
        {"id": "xiushui", "province": "æ±Ÿè¥¿çœ", "city": "ä¿®æ°´å¿"},
        {"id": "yongxiu", "province": "æ±Ÿè¥¿çœ", "city": "æ°¸ä¿®å¿"},
        {"id": "dean", "province": "æ±Ÿè¥¿çœ", "city": "å¾·å®‰å¿"},
        {"id": "duchang", "province": "æ±Ÿè¥¿çœ", "city": "éƒ½æ˜Œå¿"},
        {"id": "hukou", "province": "æ±Ÿè¥¿çœ", "city": "æ¹–å£å¿"},
        {"id": "pengze", "province": "æ±Ÿè¥¿çœ", "city": "å½­æ³½å¿"},
        {"id": "ruichang", "province": "æ±Ÿè¥¿çœ", "city": "ç‘æ˜Œå¸‚"},
        {"id": "gongqingcheng", "province": "æ±Ÿè¥¿çœ", "city": "å…±é’åŸå¸‚"},
        {"id": "lushan", "province": "æ±Ÿè¥¿çœ", "city": "åºå±±å¸‚"},
        {"id": "shangrao", "province": "æ±Ÿè¥¿çœ", "city": "ä¸Šé¥¶å¸‚"},
        {"id": "xinzhou", "province": "æ±Ÿè¥¿çœ", "city": "ä¿¡å·åŒº"},
        {"id": "guangfeng", "province": "æ±Ÿè¥¿çœ", "city": "å¹¿ä¸°åŒº"},
        {"id": "guangxin", "province": "æ±Ÿè¥¿çœ", "city": "å¹¿ä¿¡åŒº"},
        {"id": "yugan", "province": "æ±Ÿè¥¿çœ", "city": "ä½™å¹²å¿"},
        {"id": "poyang", "province": "æ±Ÿè¥¿çœ", "city": "é„±é˜³å¿"},
        {"id": "wannian", "province": "æ±Ÿè¥¿çœ", "city": "ä¸‡å¹´å¿"},
        {"id": "wuyuan", "province": "æ±Ÿè¥¿çœ", "city": "å©ºæºå¿"},
        {"id": "dexing", "province": "æ±Ÿè¥¿çœ", "city": "å¾·å…´å¸‚"},
        {"id": "yiyang", "province": "æ±Ÿè¥¿çœ", "city": "å¼‹é˜³å¿"},
        {"id": "hengfeng", "province": "æ±Ÿè¥¿çœ", "city": "æ¨ªå³°å¿"},
        {"id": "qianshan", "province": "æ±Ÿè¥¿çœ", "city": "é“…å±±å¿"},
        {"id": "yushan", "province": "æ±Ÿè¥¿çœ", "city": "ç‰å±±å¿"},
        {"id": "ganzhou", "province": "æ±Ÿè¥¿çœ", "city": "èµ£å·å¸‚"},
        {"id": "zhanggong", "province": "æ±Ÿè¥¿çœ", "city": "ç« è´¡åŒº"},
        {"id": "nankang", "province": "æ±Ÿè¥¿çœ", "city": "å—åº·åŒº"},
        {"id": "ganxian", "province": "æ±Ÿè¥¿çœ", "city": "èµ£å¿åŒº"},
        {"id": "xinfeng", "province": "æ±Ÿè¥¿çœ", "city": "ä¿¡ä¸°å¿"},
        {"id": "dayu", "province": "æ±Ÿè¥¿çœ", "city": "å¤§ä½™å¿"},
        {"id": "shangyou", "province": "æ±Ÿè¥¿çœ", "city": "ä¸ŠçŠ¹å¿"},
        {"id": "chongyi", "province": "æ±Ÿè¥¿çœ", "city": "å´‡ä¹‰å¿"},
        {"id": "anyuan", "province": "æ±Ÿè¥¿çœ", "city": "å®‰è¿œå¿"},
        {"id": "longnan", "province": "æ±Ÿè¥¿çœ", "city": "é¾™å—å¿"},
        {"id": "dingnan", "province": "æ±Ÿè¥¿çœ", "city": "å®šå—å¿"},
        {"id": "quannan", "province": "æ±Ÿè¥¿çœ", "city": "å…¨å—å¿"},
        {"id": "ningdu", "province": "æ±Ÿè¥¿çœ", "city": "å®éƒ½å¿"},
        {"id": "yudu", "province": "æ±Ÿè¥¿çœ", "city": "äºéƒ½å¿"},
        {"id": "xingguo", "province": "æ±Ÿè¥¿çœ", "city": "å…´å›½å¿"},
        {"id": "huichang", "province": "æ±Ÿè¥¿çœ", "city": "ä¼šæ˜Œå¿"},
        {"id": "xunwu", "province": "æ±Ÿè¥¿çœ", "city": "å¯»ä¹Œå¿"},
        {"id": "shicheng", "province": "æ±Ÿè¥¿çœ", "city": "çŸ³åŸå¿"},
        {"id": "ruijin", "province": "æ±Ÿè¥¿çœ", "city": "ç‘é‡‘å¸‚"},
        {"id": "jian", "province": "æ±Ÿè¥¿çœ", "city": "å‰å®‰å¸‚"},
        {"id": "jizhou", "province": "æ±Ÿè¥¿çœ", "city": "å‰å·åŒº"},
        {"id": "qingyuan", "province": "æ±Ÿè¥¿çœ", "city": "é’åŸåŒº"},
        {"id": "jishui", "province": "æ±Ÿè¥¿çœ", "city": "å‰æ°´å¿"},
        {"id": "jian_county", "province": "æ±Ÿè¥¿çœ", "city": "å‰å®‰å¿"},
        {"id": "xingan", "province": "æ±Ÿè¥¿çœ", "city": "æ–°å¹²å¿"},
        {"id": "yongfeng", "province": "æ±Ÿè¥¿çœ", "city": "æ°¸ä¸°å¿"},
        {"id": "taihe", "province": "æ±Ÿè¥¿çœ", "city": "æ³°å’Œå¿"},
        {"id": "suichuan", "province": "æ±Ÿè¥¿çœ", "city": "é‚å·å¿"},
        {"id": "wanan", "province": "æ±Ÿè¥¿çœ", "city": "ä¸‡å®‰å¿"},
        {"id": "anfu", "province": "æ±Ÿè¥¿çœ", "city": "å®‰ç¦å¿"},
        {"id": "yongxin", "province": "æ±Ÿè¥¿çœ", "city": "æ°¸æ–°å¿"},
        {"id": "jinggangshan", "province": "æ±Ÿè¥¿çœ", "city": "äº•å†ˆå±±å¸‚"},
        {"id": "yichun", "province": "æ±Ÿè¥¿çœ", "city": "å®œæ˜¥å¸‚"},
        {"id": "yuanzhou", "province": "æ±Ÿè¥¿çœ", "city": "è¢å·åŒº"},
        {"id": "fengxin", "province": "æ±Ÿè¥¿çœ", "city": "å¥‰æ–°å¿"},
        {"id": "wanzai", "province": "æ±Ÿè¥¿çœ", "city": "ä¸‡è½½å¿"},
        {"id": "shanggao", "province": "æ±Ÿè¥¿çœ", "city": "ä¸Šé«˜å¿"},
        {"id": "yifeng", "province": "æ±Ÿè¥¿çœ", "city": "å®œä¸°å¿"},
        {"id": "jing_an", "province": "æ±Ÿè¥¿çœ", "city": "é–å®‰å¿"},
        {"id": "tonggu", "province": "æ±Ÿè¥¿çœ", "city": "é“œé¼“å¿"},
        {"id": "fengcheng", "province": "æ±Ÿè¥¿çœ", "city": "ä¸°åŸå¸‚"},
        {"id": "zhangshu", "province": "æ±Ÿè¥¿çœ", "city": "æ¨Ÿæ ‘å¸‚"},
        {"id": "gaoan", "province": "æ±Ÿè¥¿çœ", "city": "é«˜å®‰å¸‚"},
        {"id": "fuzhou", "province": "æ±Ÿè¥¿çœ", "city": "æŠšå·å¸‚"},
        {"id": "linchuan", "province": "æ±Ÿè¥¿çœ", "city": "ä¸´å·åŒº"},
        {"id": "dongxiang", "province": "æ±Ÿè¥¿çœ", "city": "ä¸œä¹¡åŒº"},
        {"id": "nancheng", "province": "æ±Ÿè¥¿çœ", "city": "å—åŸå¿"},
        {"id": "lichuan", "province": "æ±Ÿè¥¿çœ", "city": "é»å·å¿"},
        {"id": "nanfeng", "province": "æ±Ÿè¥¿çœ", "city": "å—ä¸°å¿"},
        {"id": "chongren", "province": "æ±Ÿè¥¿çœ", "city": "å´‡ä»å¿"},
        {"id": "lean", "province": "æ±Ÿè¥¿çœ", "city": "ä¹å®‰å¿"},
        {"id": "yihuang", "province": "æ±Ÿè¥¿çœ", "city": "å®œé»„å¿"},
        {"id": "jinxi", "province": "æ±Ÿè¥¿çœ", "city": "é‡‘æºªå¿"},
        {"id": "zixi", "province": "æ±Ÿè¥¿çœ", "city": "èµ„æºªå¿"},
        {"id": "guangchang", "province": "æ±Ÿè¥¿çœ", "city": "å¹¿æ˜Œå¿"},
        {"id": "pingxiang", "province": "æ±Ÿè¥¿çœ", "city": "èä¹¡å¸‚"},
        {"id": "anyuan_px", "province": "æ±Ÿè¥¿çœ", "city": "å®‰æºåŒº"},
        {"id": "xiangdong", "province": "æ±Ÿè¥¿çœ", "city": "æ¹˜ä¸œåŒº"},
        {"id": "lianhua", "province": "æ±Ÿè¥¿çœ", "city": "è²èŠ±å¿"},
        {"id": "shangli", "province": "æ±Ÿè¥¿çœ", "city": "ä¸Šæ —å¿"},
        {"id": "luxi", "province": "æ±Ÿè¥¿çœ", "city": "èŠ¦æºªå¿"},
        {"id": "xinyu", "province": "æ±Ÿè¥¿çœ", "city": "æ–°ä½™å¸‚"},
        {"id": "yushui", "province": "æ±Ÿè¥¿çœ", "city": "æ¸æ°´åŒº"},
        {"id": "fenyi", "province": "æ±Ÿè¥¿çœ", "city": "åˆ†å®œå¿"},
        {"id": "yingtan", "province": "æ±Ÿè¥¿çœ", "city": "é¹°æ½­å¸‚"},
        {"id": "yujiang", "province": "æ±Ÿè¥¿çœ", "city": "ä½™æ±ŸåŒº"},
        {"id": "guixi", "province": "æ±Ÿè¥¿çœ", "city": "è´µæºªå¸‚"},
        {"id": "jingdezhen", "province": "æ±Ÿè¥¿çœ", "city": "æ™¯å¾·é•‡å¸‚"},
        {"id": "changjiang", "province": "æ±Ÿè¥¿çœ", "city": "æ˜Œæ±ŸåŒº"},
        {"id": "zhushan", "province": "æ±Ÿè¥¿çœ", "city": "ç å±±åŒº"},
        {"id": "fuliang", "province": "æ±Ÿè¥¿çœ", "city": "æµ®æ¢å¿"},
        {"id": "leping", "province": "æ±Ÿè¥¿çœ", "city": "ä¹å¹³å¸‚"}
      ];

      const DOT = 'Â·';
      let allLocations = LOCATIONS;
      let filteredLocations = LOCATIONS;

      const citySelect = document.getElementById('city-select');
      const citySearch = document.getElementById('city-search');
      const refreshBtn = document.getElementById('refresh-btn');
      const weatherDisplay = document.getElementById('weather-display');
      const errorDisplay = document.getElementById('error-display');

      function createOptionLabel(location) {
        return location.city;
      }

      function populateSelect(locations) {
        citySelect.innerHTML = '';
        locations.forEach(loc => {
          const option = document.createElement('option');
          option.value = loc.id;
          option.textContent = createOptionLabel(loc);
          citySelect.appendChild(option);
        });
      }

      function filterLocations(query) {
        if (!query.trim()) {
          filteredLocations = allLocations;
        } else {
          const lowerQuery = query.toLowerCase();
          filteredLocations = allLocations.filter(loc =>
            loc.city.toLowerCase().includes(lowerQuery) ||
            loc.id.toLowerCase().includes(lowerQuery)
          );
        }
        populateSelect(filteredLocations);
      }

      async function fetchWeather(locationId) {
        try {
          console.log('Fetching weather for:', locationId);
          const response = await fetch(`/.netlify/functions/weather?location_id=${locationId}`);
          console.log('Response status:', response.status);
          if (!response.ok) {
            const errorText = await response.text();
            console.error('Error response:', errorText);
            throw new Error('Failed to fetch weather data');
          }
          const data = await response.json();
          console.log('Weather data:', data);
          displayWeather(data);
        } catch (error) {
          console.error('Fetch error:', error);
          displayError('æ— æ³•è·å–å¤©æ°”æ•°æ®ï¼Œè¯·ç¨åé‡è¯•: ' + error.message);
        }
      }

      function displayWeather(data) {
        weatherDisplay.style.display = 'block';
        errorDisplay.style.display = 'none';

        document.getElementById('location-name').textContent = data.location.city;
        document.getElementById('current-temperature').textContent = data.current.temperature;
        document.getElementById('current-weather').textContent = data.current.weather;
        document.getElementById('feels-like').textContent = `${data.current.feels_like}Â°C`;
        document.getElementById('humidity').textContent = `${data.current.humidity}%`;
        document.getElementById('wind-speed').textContent = `${data.current.wind_speed} km/h`;

        const forecastList = document.getElementById('forecast-list');
        forecastList.innerHTML = '';
        data.forecast.forEach(day => {
          const item = document.createElement('div');
          item.className = 'forecast-item';
          item.innerHTML = `
            <div class="forecast-item__date">${day.date}</div>
            <div class="forecast-item__weather">${day.weather}</div>
            <div class="forecast-item__temp">
              <span class="temp-max">${day.max_temp}Â°</span>
              <span class="temp-sep">/</span>
              <span class="temp-min">${day.min_temp}Â°</span>
            </div>
          `;
          forecastList.appendChild(item);
        });
      }

      function displayError(message) {
        weatherDisplay.style.display = 'none';
        errorDisplay.style.display = 'block';
        document.getElementById('error-message').textContent = message;
      }

      // Event listeners
      citySearch.addEventListener('input', (e) => {
        filterLocations(e.target.value);
      });

      citySelect.addEventListener('change', () => {
        fetchWeather(citySelect.value);
      });

      refreshBtn.addEventListener('click', () => {
        fetchWeather(citySelect.value);
      });

      // Initialize
      populateSelect(allLocations);
      fetchWeather('nanchang');
    </script>
  </body>
</html>

