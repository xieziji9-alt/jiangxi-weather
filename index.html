<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>江西省天气预报</title>
    <link rel="stylesheet" href="static/styles.css">
  </head>
  <body>
    <header class="page-header">
      <h1 class="page-title">🌤️ 江西省天气预报</h1>
      <p class="page-subtitle">实时天气 · 未来 5 日预报 · 覆盖全省市县</p>
    </header>
    <main class="page-main">
      <section class="controls glass">
        <div class="controls__inner">
          <input
            id="city-search"
            class="city-search"
            type="text"
            placeholder="🔍 输入城市或县区名称快速查找..."
            aria-label="输入城市或县区速查"
            autocomplete="off"
          >
          <div class="control-row">
            <select id="city-select" aria-label="选择江西省城市或县区">
              <!-- Options will be populated by JavaScript -->
            </select>
            <button id="refresh-btn" type="button">🔄 刷新天气</button>
          </div>
        </div>
      </section>

      <section id="weather-display" class="weather-display glass" style="display: none;">
        <div class="weather-hero">
          <div class="weather-hero__location">
            <h2 id="location-name">--</h2>
          </div>
          <div class="weather-hero__current">
            <div class="current-temp">
              <span id="current-temperature" class="current-temp__value">--</span>
              <span class="current-temp__unit">°C</span>
            </div>
            <div id="current-weather" class="current-weather">--</div>
          </div>
          <div class="weather-hero__details">
            <div class="detail-item">
              <span class="detail-label">体感温度</span>
              <span id="feels-like" class="detail-value">--°C</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">湿度</span>
              <span id="humidity" class="detail-value">--%</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">风速</span>
              <span id="wind-speed" class="detail-value">-- km/h</span>
            </div>
          </div>
        </div>

        <div class="forecast">
          <h3 class="forecast__title">未来 5 日预报</h3>
          <div id="forecast-list" class="forecast__list">
            <!-- Forecast items will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <section id="error-display" class="error-display" style="display: none;">
        <p id="error-message"></p>
      </section>
    </main>
    <footer class="page-footer">
      <small>数据来源：<a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo 免费天气服务</a></small>
    </footer>

    <script>
      // Location data
      const LOCATIONS = [
        {"id": "nanchang", "province": "江西省", "city": "南昌市"},
        {"id": "donghu", "province": "江西省", "city": "东湖区"},
        {"id": "xihu", "province": "江西省", "city": "西湖区"},
        {"id": "qingyunpu", "province": "江西省", "city": "青云谱区"},
        {"id": "qingshanhu", "province": "江西省", "city": "青山湖区"},
        {"id": "xinjian", "province": "江西省", "city": "新建区"},
        {"id": "nanchang_county", "province": "江西省", "city": "南昌县"},
        {"id": "anyi", "province": "江西省", "city": "安义县"},
        {"id": "jinxian", "province": "江西省", "city": "进贤县"},
        {"id": "jiujiang", "province": "江西省", "city": "九江市"},
        {"id": "xunyang", "province": "江西省", "city": "浔阳区"},
        {"id": "lianxi", "province": "江西省", "city": "濂溪区"},
        {"id": "chaisang", "province": "江西省", "city": "柴桑区"},
        {"id": "wuning", "province": "江西省", "city": "武宁县"},
        {"id": "xiushui", "province": "江西省", "city": "修水县"},
        {"id": "yongxiu", "province": "江西省", "city": "永修县"},
        {"id": "dean", "province": "江西省", "city": "德安县"},
        {"id": "duchang", "province": "江西省", "city": "都昌县"},
        {"id": "hukou", "province": "江西省", "city": "湖口县"},
        {"id": "pengze", "province": "江西省", "city": "彭泽县"},
        {"id": "ruichang", "province": "江西省", "city": "瑞昌市"},
        {"id": "gongqingcheng", "province": "江西省", "city": "共青城市"},
        {"id": "lushan", "province": "江西省", "city": "庐山市"},
        {"id": "shangrao", "province": "江西省", "city": "上饶市"},
        {"id": "xinzhou", "province": "江西省", "city": "信州区"},
        {"id": "guangfeng", "province": "江西省", "city": "广丰区"},
        {"id": "guangxin", "province": "江西省", "city": "广信区"},
        {"id": "yugan", "province": "江西省", "city": "余干县"},
        {"id": "poyang", "province": "江西省", "city": "鄱阳县"},
        {"id": "wannian", "province": "江西省", "city": "万年县"},
        {"id": "wuyuan", "province": "江西省", "city": "婺源县"},
        {"id": "dexing", "province": "江西省", "city": "德兴市"},
        {"id": "yiyang", "province": "江西省", "city": "弋阳县"},
        {"id": "hengfeng", "province": "江西省", "city": "横峰县"},
        {"id": "qianshan", "province": "江西省", "city": "铅山县"},
        {"id": "yushan", "province": "江西省", "city": "玉山县"},
        {"id": "ganzhou", "province": "江西省", "city": "赣州市"},
        {"id": "zhanggong", "province": "江西省", "city": "章贡区"},
        {"id": "nankang", "province": "江西省", "city": "南康区"},
        {"id": "ganxian", "province": "江西省", "city": "赣县区"},
        {"id": "xinfeng", "province": "江西省", "city": "信丰县"},
        {"id": "dayu", "province": "江西省", "city": "大余县"},
        {"id": "shangyou", "province": "江西省", "city": "上犹县"},
        {"id": "chongyi", "province": "江西省", "city": "崇义县"},
        {"id": "anyuan", "province": "江西省", "city": "安远县"},
        {"id": "longnan", "province": "江西省", "city": "龙南县"},
        {"id": "dingnan", "province": "江西省", "city": "定南县"},
        {"id": "quannan", "province": "江西省", "city": "全南县"},
        {"id": "ningdu", "province": "江西省", "city": "宁都县"},
        {"id": "yudu", "province": "江西省", "city": "于都县"},
        {"id": "xingguo", "province": "江西省", "city": "兴国县"},
        {"id": "huichang", "province": "江西省", "city": "会昌县"},
        {"id": "xunwu", "province": "江西省", "city": "寻乌县"},
        {"id": "shicheng", "province": "江西省", "city": "石城县"},
        {"id": "ruijin", "province": "江西省", "city": "瑞金市"},
        {"id": "jian", "province": "江西省", "city": "吉安市"},
        {"id": "jizhou", "province": "江西省", "city": "吉州区"},
        {"id": "qingyuan", "province": "江西省", "city": "青原区"},
        {"id": "jishui", "province": "江西省", "city": "吉水县"},
        {"id": "jian_county", "province": "江西省", "city": "吉安县"},
        {"id": "xingan", "province": "江西省", "city": "新干县"},
        {"id": "yongfeng", "province": "江西省", "city": "永丰县"},
        {"id": "taihe", "province": "江西省", "city": "泰和县"},
        {"id": "suichuan", "province": "江西省", "city": "遂川县"},
        {"id": "wanan", "province": "江西省", "city": "万安县"},
        {"id": "anfu", "province": "江西省", "city": "安福县"},
        {"id": "yongxin", "province": "江西省", "city": "永新县"},
        {"id": "jinggangshan", "province": "江西省", "city": "井冈山市"},
        {"id": "yichun", "province": "江西省", "city": "宜春市"},
        {"id": "yuanzhou", "province": "江西省", "city": "袁州区"},
        {"id": "fengxin", "province": "江西省", "city": "奉新县"},
        {"id": "wanzai", "province": "江西省", "city": "万载县"},
        {"id": "shanggao", "province": "江西省", "city": "上高县"},
        {"id": "yifeng", "province": "江西省", "city": "宜丰县"},
        {"id": "jing_an", "province": "江西省", "city": "靖安县"},
        {"id": "tonggu", "province": "江西省", "city": "铜鼓县"},
        {"id": "fengcheng", "province": "江西省", "city": "丰城市"},
        {"id": "zhangshu", "province": "江西省", "city": "樟树市"},
        {"id": "gaoan", "province": "江西省", "city": "高安市"},
        {"id": "fuzhou", "province": "江西省", "city": "抚州市"},
        {"id": "linchuan", "province": "江西省", "city": "临川区"},
        {"id": "dongxiang", "province": "江西省", "city": "东乡区"},
        {"id": "nancheng", "province": "江西省", "city": "南城县"},
        {"id": "lichuan", "province": "江西省", "city": "黎川县"},
        {"id": "nanfeng", "province": "江西省", "city": "南丰县"},
        {"id": "chongren", "province": "江西省", "city": "崇仁县"},
        {"id": "lean", "province": "江西省", "city": "乐安县"},
        {"id": "yihuang", "province": "江西省", "city": "宜黄县"},
        {"id": "jinxi", "province": "江西省", "city": "金溪县"},
        {"id": "zixi", "province": "江西省", "city": "资溪县"},
        {"id": "guangchang", "province": "江西省", "city": "广昌县"},
        {"id": "pingxiang", "province": "江西省", "city": "萍乡市"},
        {"id": "anyuan_px", "province": "江西省", "city": "安源区"},
        {"id": "xiangdong", "province": "江西省", "city": "湘东区"},
        {"id": "lianhua", "province": "江西省", "city": "莲花县"},
        {"id": "shangli", "province": "江西省", "city": "上栗县"},
        {"id": "luxi", "province": "江西省", "city": "芦溪县"},
        {"id": "xinyu", "province": "江西省", "city": "新余市"},
        {"id": "yushui", "province": "江西省", "city": "渝水区"},
        {"id": "fenyi", "province": "江西省", "city": "分宜县"},
        {"id": "yingtan", "province": "江西省", "city": "鹰潭市"},
        {"id": "yujiang", "province": "江西省", "city": "余江区"},
        {"id": "guixi", "province": "江西省", "city": "贵溪市"},
        {"id": "jingdezhen", "province": "江西省", "city": "景德镇市"},
        {"id": "changjiang", "province": "江西省", "city": "昌江区"},
        {"id": "zhushan", "province": "江西省", "city": "珠山区"},
        {"id": "fuliang", "province": "江西省", "city": "浮梁县"},
        {"id": "leping", "province": "江西省", "city": "乐平市"}
      ];

      const DOT = '·';
      let allLocations = LOCATIONS;
      let filteredLocations = LOCATIONS;

      const citySelect = document.getElementById('city-select');
      const citySearch = document.getElementById('city-search');
      const refreshBtn = document.getElementById('refresh-btn');
      const weatherDisplay = document.getElementById('weather-display');
      const errorDisplay = document.getElementById('error-display');

      function createOptionLabel(location) {
        return location.city;
      }

      function populateSelect(locations) {
        citySelect.innerHTML = '';
        locations.forEach(loc => {
          const option = document.createElement('option');
          option.value = loc.id;
          option.textContent = createOptionLabel(loc);
          citySelect.appendChild(option);
        });
      }

      function filterLocations(query) {
        if (!query.trim()) {
          filteredLocations = allLocations;
        } else {
          const lowerQuery = query.toLowerCase();
          filteredLocations = allLocations.filter(loc =>
            loc.city.toLowerCase().includes(lowerQuery) ||
            loc.id.toLowerCase().includes(lowerQuery)
          );
        }
        populateSelect(filteredLocations);
      }

      // Coordinates for major cities in Jiangxi
      const COORDINATES = {
        'nanchang': { lat: 28.6829, lon: 115.8579 },
        'donghu': { lat: 28.6850, lon: 115.8990 },
        'xihu': { lat: 28.6570, lon: 115.8770 },
        'qingyunpu': { lat: 28.6210, lon: 115.9250 },
        'qingshanhu': { lat: 28.6820, lon: 115.9620 },
        'xinjian': { lat: 28.6920, lon: 115.8150 },
        'nanchang_county': { lat: 28.5450, lon: 115.9430 },
        'anyi': { lat: 28.8450, lon: 115.5480 },
        'jinxian': { lat: 28.3760, lon: 116.2420 },
        'jiujiang': { lat: 29.7050, lon: 116.0010 },
        'xunyang': { lat: 29.7270, lon: 115.9900 },
        'lianxi': { lat: 29.6700, lon: 115.9850 },
        'chaisang': { lat: 29.6000, lon: 115.9110 },
        'wuning': { lat: 29.2560, lon: 115.1010 },
        'xiushui': { lat: 29.0250, lon: 114.5470 },
        'yongxiu': { lat: 29.0220, lon: 115.8090 },
        'dean': { lat: 29.3130, lon: 115.7560 },
        'duchang': { lat: 29.2730, lon: 116.2040 },
        'hukou': { lat: 29.7410, lon: 116.2520 },
        'pengze': { lat: 29.8960, lon: 116.5490 },
        'ruichang': { lat: 29.6740, lon: 115.6810 },
        'gongqingcheng': { lat: 29.2480, lon: 115.8040 },
        'lushan': { lat: 29.4480, lon: 115.9820 },
        'shangrao': { lat: 28.4540, lon: 117.9430 },
        'xinzhou': { lat: 28.4310, lon: 117.9660 },
        'guangfeng': { lat: 28.4360, lon: 118.1910 },
        'guangxin': { lat: 28.4500, lon: 117.9700 },
        'yugan': { lat: 28.6950, lon: 116.6960 },
        'poyang': { lat: 29.0110, lon: 116.6730 },
        'wannian': { lat: 28.6950, lon: 117.0690 },
        'wuyuan': { lat: 29.2450, lon: 117.8610 },
        'dexing': { lat: 28.9470, lon: 117.5790 },
        'yiyang': { lat: 28.3740, lon: 117.4590 },
        'hengfeng': { lat: 28.4070, lon: 117.5960 },
        'qianshan': { lat: 28.3150, lon: 117.7090 },
        'yushan': { lat: 28.6820, lon: 118.2450 },
        'ganzhou': { lat: 25.8310, lon: 114.9350 },
        'zhanggong': { lat: 25.8170, lon: 114.9350 },
        'nankang': { lat: 25.6630, lon: 114.7650 },
        'ganxian': { lat: 25.8600, lon: 115.0120 },
        'xinfeng': { lat: 25.3690, lon: 114.9090 },
        'dayu': { lat: 25.2940, lon: 114.3620 },
        'shangyou': { lat: 25.7880, lon: 114.5500 },
        'chongyi': { lat: 25.6810, lon: 114.3080 },
        'anyuan': { lat: 25.1370, lon: 115.3930 },
        'longnan': { lat: 24.9110, lon: 114.7890 },
        'dingnan': { lat: 24.7840, lon: 115.0280 },
        'quannan': { lat: 24.7420, lon: 114.5300 },
        'ningdu': { lat: 26.4700, lon: 116.0090 },
        'yudu': { lat: 25.9520, lon: 115.4150 },
        'xingguo': { lat: 26.3380, lon: 115.3630 },
        'huichang': { lat: 25.5990, lon: 115.7860 },
        'xunwu': { lat: 24.9540, lon: 115.6490 },
        'shicheng': { lat: 26.3150, lon: 116.3440 },
        'ruijin': { lat: 25.8850, lon: 116.0270 },
        'jian': { lat: 27.1110, lon: 114.9860 },
        'jizhou': { lat: 27.1440, lon: 115.0000 },
        'qingyuan': { lat: 27.0820, lon: 115.0140 },
        'jishui': { lat: 27.2290, lon: 115.1350 },
        'jian_county': { lat: 27.0400, lon: 114.9080 },
        'xingan': { lat: 27.7380, lon: 115.3950 },
        'yongfeng': { lat: 27.3180, lon: 115.4420 },
        'taihe': { lat: 26.7910, lon: 114.9080 },
        'suichuan': { lat: 26.3130, lon: 114.5200 },
        'wanan': { lat: 26.4580, lon: 114.7870 },
        'anfu': { lat: 27.3930, lon: 114.6200 },
        'yongxin': { lat: 26.9450, lon: 114.2430 },
        'jinggangshan': { lat: 26.7480, lon: 114.1890 },
        'yichun': { lat: 27.8150, lon: 114.4170 },
        'yuanzhou': { lat: 27.7970, lon: 114.4230 },
        'fengxin': { lat: 28.6920, lon: 115.4000 },
        'wanzai': { lat: 28.1060, lon: 114.4450 },
        'shanggao': { lat: 28.2340, lon: 114.9250 },
        'yifeng': { lat: 28.3940, lon: 114.7800 },
        'jing_an': { lat: 28.8610, lon: 115.3620 },
        'tonggu': { lat: 28.5230, lon: 114.3710 },
        'fengcheng': { lat: 28.1590, lon: 115.7710 },
        'zhangshu': { lat: 28.0530, lon: 115.5460 },
        'gaoan': { lat: 28.4170, lon: 115.3750 },
        'fuzhou': { lat: 27.9490, lon: 116.3580 },
        'linchuan': { lat: 27.9770, lon: 116.3130 },
        'dongxiang': { lat: 28.2360, lon: 116.5900 },
        'nancheng': { lat: 27.5540, lon: 116.6270 },
        'lichuan': { lat: 27.2790, lon: 116.9070 },
        'nanfeng': { lat: 27.2180, lon: 116.5260 },
        'chongren': { lat: 27.7540, lon: 116.0750 },
        'lean': { lat: 27.4290, lon: 115.8300 },
        'yihuang': { lat: 27.5540, lon: 116.2360 },
        'jinxi': { lat: 27.9190, lon: 116.7550 },
        'zixi': { lat: 27.7060, lon: 117.0690 },
        'guangchang': { lat: 26.8440, lon: 116.3370 },
        'pingxiang': { lat: 27.6230, lon: 113.8520 },
        'anyuan_px': { lat: 27.6150, lon: 113.8700 },
        'xiangdong': { lat: 27.6390, lon: 113.7330 },
        'lianhua': { lat: 27.1270, lon: 113.9620 },
        'shangli': { lat: 27.8800, lon: 113.7950 },
        'luxi': { lat: 27.6300, lon: 114.0290 },
        'xinyu': { lat: 27.8180, lon: 114.9170 },
        'yushui': { lat: 27.8000, lon: 114.9440 },
        'fenyi': { lat: 27.8150, lon: 114.6750 },
        'yingtan': { lat: 28.2380, lon: 117.0690 },
        'yujiang': { lat: 28.2040, lon: 116.8190 },
        'guixi': { lat: 28.2920, lon: 117.2450 },
        'jingdezhen': { lat: 29.2686, lon: 117.1786 },
        'changjiang': { lat: 29.2730, lon: 117.1750 },
        'zhushan': { lat: 29.3010, lon: 117.2140 },
        'fuliang': { lat: 29.3380, lon: 117.2150 },
        'leping': { lat: 28.9620, lon: 117.1300 }
      };

      function getWeatherDescription(code) {
        const weatherCodes = {
          0: '晴天',
          1: '晴朗', 2: '少云', 3: '多云',
          45: '有雾', 48: '雾凇',
          51: '小雨', 53: '中雨', 55: '大雨',
          61: '小雨', 63: '中雨', 65: '大雨',
          71: '小雪', 73: '中雪', 75: '大雪',
          77: '米雪',
          80: '阵雨', 81: '阵雨', 82: '暴雨',
          85: '阵雪', 86: '暴雪',
          95: '雷暴', 96: '雷暴伴冰雹', 99: '雷暴伴冰雹'
        };
        return weatherCodes[code] || '未知';
      }

      async function fetchWeather(locationId) {
        try {
          const location = LOCATIONS.find(loc => loc.id === locationId);
          if (!location) {
            throw new Error('未找到该城市');
          }

          const coords = COORDINATES[locationId];
          if (!coords) {
            throw new Error('该城市暂无天气数据');
          }

          const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia/Shanghai&forecast_days=6`;

          const response = await fetch(url);
          if (!response.ok) {
            throw new Error('天气服务暂时不可用');
          }

          const apiData = await response.json();

          const data = {
            location: {
              province: location.province,
              city: location.city
            },
            current: {
              temperature: Math.round(apiData.current.temperature_2m),
              weather: getWeatherDescription(apiData.current.weather_code),
              feels_like: Math.round(apiData.current.apparent_temperature),
              humidity: apiData.current.relative_humidity_2m,
              wind_speed: Math.round(apiData.current.wind_speed_10m)
            },
            forecast: []
          };

          for (let i = 1; i < 6; i++) {
            const date = new Date(apiData.daily.time[i]);
            const dateStr = `${date.getMonth() + 1}月${date.getDate()}日`;
            data.forecast.push({
              date: dateStr,
              weather: getWeatherDescription(apiData.daily.weather_code[i]),
              max_temp: Math.round(apiData.daily.temperature_2m_max[i]),
              min_temp: Math.round(apiData.daily.temperature_2m_min[i])
            });
          }

          displayWeather(data);
        } catch (error) {
          console.error('Fetch error:', error);
          displayError('无法获取天气数据，请稍后重试: ' + error.message);
        }
      }

      function displayWeather(data) {
        weatherDisplay.style.display = 'block';
        errorDisplay.style.display = 'none';

        document.getElementById('location-name').textContent = data.location.city;
        document.getElementById('current-temperature').textContent = data.current.temperature;
        document.getElementById('current-weather').textContent = data.current.weather;
        document.getElementById('feels-like').textContent = `${data.current.feels_like}°C`;
        document.getElementById('humidity').textContent = `${data.current.humidity}%`;
        document.getElementById('wind-speed').textContent = `${data.current.wind_speed} km/h`;

        const forecastList = document.getElementById('forecast-list');
        forecastList.innerHTML = '';
        data.forecast.forEach(day => {
          const item = document.createElement('div');
          item.className = 'forecast-item';
          item.innerHTML = `
            <div class="forecast-item__date">${day.date}</div>
            <div class="forecast-item__weather">${day.weather}</div>
            <div class="forecast-item__temp">
              <span class="temp-max">${day.max_temp}°</span>
              <span class="temp-sep">/</span>
              <span class="temp-min">${day.min_temp}°</span>
            </div>
          `;
          forecastList.appendChild(item);
        });
      }

      function displayError(message) {
        weatherDisplay.style.display = 'none';
        errorDisplay.style.display = 'block';
        document.getElementById('error-message').textContent = message;
      }

      // Event listeners
      citySearch.addEventListener('input', (e) => {
        filterLocations(e.target.value);
      });

      citySelect.addEventListener('change', () => {
        fetchWeather(citySelect.value);
      });

      refreshBtn.addEventListener('click', () => {
        fetchWeather(citySelect.value);
      });

      // Initialize
      populateSelect(allLocations);
      fetchWeather('nanchang');
    </script>
  </body>
</html>

